# Motion Capture Electron App - Setup & Migration Guide

## üöÄ Quick Start

### Prerequisites
- Node.js 18+ and npm/yarn
- Your existing motion processing codebase
- USB/Bluetooth permissions for device access

### Installation

```bash
# 1. Clone or create project directory
mkdir motion-capture-electron
cd motion-capture-electron

# 2. Initialize package.json (use the provided package.json)
npm init -y

# 3. Install dependencies
npm install

# 4. Copy your existing motion processing code
# Copy from your current src/services/motionProcessing/ to this project
```

### Project Structure
```
motion-capture-electron/
‚îú‚îÄ‚îÄ electron/
‚îÇ   ‚îú‚îÄ‚îÄ main/                    # Main process (Node.js)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.ts             # Entry point
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/           # Motion processing integration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/              # TypeScript definitions
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/              # Utilities & helpers
‚îÇ   ‚îú‚îÄ‚îÄ preload/                # Secure IPC bridge
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ preload.ts
‚îÇ   ‚îî‚îÄ‚îÄ renderer/               # UI (React)
‚îÇ       ‚îú‚îÄ‚îÄ index.html
‚îÇ       ‚îú‚îÄ‚îÄ main.tsx
‚îÇ       ‚îî‚îÄ‚îÄ ElectronMotionApp.tsx
‚îú‚îÄ‚îÄ src/                        # Your existing code
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ motionProcessing/   # Copy your existing motion processing
‚îÇ   ‚îî‚îÄ‚îÄ sdk/                    # Copy your existing SDK
‚îú‚îÄ‚îÄ dist/                       # Built files
‚îú‚îÄ‚îÄ build/                      # Packaged applications
‚îî‚îÄ‚îÄ assets/                     # App icons, etc.
```

## üì¶ Migration Steps

### Step 1: Copy Existing Code

```bash
# Copy your motion processing services
cp -r your-existing-app/src/services/motionProcessing ./src/services/
cp -r your-existing-app/src/sdk ./src/

# Ensure these key files exist:
# - src/services/motionProcessing/MotionProcessingCoordinator.ts
# - src/services/motionProcessing/hooks/useMotionProcessing.ts
# - src/sdk/core/MuseManager.ts
# - src/sdk/core/MuseData.ts
```

### Step 2: Update Import Paths

Update any imports in your motion processing code to work with the new structure:

```typescript
// OLD (in React app)
import { motionProcessingCoordinator } from '@/services/motionProcessing/MotionProcessingCoordinator';

// NEW (in Electron)
import { motionProcessingCoordinator } from '../../../services/motionProcessing/MotionProcessingCoordinator';
```

### Step 3: Configure TypeScript

Create `tsconfig.main.json` for the main process and ensure path mapping works:

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
```

### Step 4: Environment Setup

Create `.env` file for development:

```env
NODE_ENV=development
ELECTRON_IS_DEV=true
WS_PORT=8080
LOG_LEVEL=debug
```

## üõ†Ô∏è Development Workflow

### Development Mode

```bash
# Start all development processes
npm run dev

# This runs:
# 1. TypeScript compiler for main process (watch mode)
# 2. Vite dev server for renderer process  
# 3. Electron app pointing to localhost:3000
```

### Individual Commands

```bash
# Build main process only
npm run build:main

# Build renderer process only  
npm run build:renderer

# Run Electron with built files
npm run electron

# Clean build artifacts
npm run clean
```

### Debugging

```bash
# Enable debug mode
NODE_ENV=development npm run electron:dev

# Main process debugging (attach to Node.js debugger)
# Renderer process debugging (Chrome DevTools automatically open)
```

## üîß Configuration Options

### WebSocket Server Configuration

Edit `electron/main/services/ElectronMotionService.ts`:

```typescript
// Change WebSocket port
private readonly WS_PORT = 8080; // Change this

// Adjust data batching
this.dataBatcher = new DataBatcher(
    (data) => this.broadcastMotionData(data),
    10,  // batch size - increase for less frequent updates
    16   // max delay (ms) - increase for less CPU usage
);

// Heartbeat interval
private readonly HEARTBEAT_INTERVAL = 30000; // 30 seconds
```

### Motion Processing Configuration

Your existing motion processing config should work as-is:

```typescript
// This remains the same as your current setup
const config = createMotionConfig(PerformanceProfile.HZ_100_SAMPLING);
```

## üì± UI Customization

### Simplifying the Interface

The default UI includes only essential controls. To customize:

```typescript
// electron/renderer/ElectronMotionApp.tsx

// Add custom components
const CustomControls = () => (
  <div className="custom-section">
    {/* Your custom UI elements */}
  </div>
);

// Modify the main layout
return (
  <div className="app-layout">
    <DeviceStatus />
    <RecordingControl />
    <CustomControls />  {/* Add here */}
    <MotionDataDisplay />
  </div>
);
```

### Styling

The app uses Tailwind CSS. Customize colors in `tailwind.config.js`:

```javascript
theme: {
  extend: {
    colors: {
      primary: {
        DEFAULT: "#YOUR_BRAND_COLOR",
        foreground: "#ffffff",
      },
    },
  },
}
```

## üåê Web Client Integration

### Running the Web Dashboard

```bash
# In a separate terminal, serve the web client
cd web-dashboard
npm install
npm run dev

# Access at http://localhost:3001
```

### Connecting Multiple Clients

Multiple web clients can connect to the same Electron app:

```typescript
// Each client connects to ws://localhost:8080
// The Electron app broadcasts to all connected clients
// Useful for:
// - Remote monitoring
// - Multiple displays
// - Recording different views
```

## üì¶ Building & Distribution

### Development Build

```bash
npm run build
```

### Production Packages

```bash
# Build for current platform
npm run package

# Build for specific platforms
npm run package:win    # Windows
npm run package:mac    # macOS  
npm run package:linux  # Linux
```

### Code Signing (Production)

For distribution, add code signing certificates:

```json
// In package.json build config
"build": {
  "mac": {
    "identity": "Developer ID Application: Your Name",
  },
  "win": {
    "certificateFile": "path/to/certificate.p12",
    "certificatePassword": "password"
  }
}
```

## üîç Troubleshooting

### Common Issues

**1. Motion Processing Not Initializing**
```bash
# Check if coordinator is properly imported
# Verify the motion processing files are in src/services/motionProcessing/
# Check console for initialization errors
```

**2. WebSocket Connection Failed**
```bash
# Verify port 8080 is not in use
netstat -an | grep 8080

# Check firewall settings
# Try different port in ElectronMotionService.ts
```

**3. Bluetooth Devices Not Found**
```bash
# Ensure Bluetooth permissions in entitlements.mac.plist
# Check device pairing status
# Verify Web Bluetooth is enabled in Chromium
```

**4. Build Errors**
```bash
# Clear and rebuild
npm run clean
npm install
npm run build
```

### Debug Logging

Enable detailed logging:

```typescript
// In ElectronMotionService.ts
console.log('üîç Debug:', {
  devices: this.connectedDevices.size,
  recording: this.isRecording,
  clients: this.clients.size
});
```

### Performance Monitoring

Check performance metrics:

```typescript
// Access performance data via WebSocket
{
  type: 'performance_metrics',
  data: {
    memoryUsage: process.memoryUsage(),
    cpuUsage: process.cpuUsage(),
    wsConnections: clientCount
  }
}
```

## üîÑ Data Flow Architecture

### Understanding the Pipeline

```
IMU Devices (Bluetooth)
         ‚Üì
    Muse SDK (electron/main)
         ‚Üì
Motion Processing Coordinator
         ‚Üì
    WebSocket Server
         ‚Üì ‚Üì ‚Üì
[Electron UI] [Web Client 1] [Web Client 2]
```

### Message Flow

1. **Device Data**: Raw IMU ‚Üí SDK ‚Üí Motion Processing
2. **Processed Data**: Coordinator ‚Üí WebSocket ‚Üí UI
3. **Commands**: UI ‚Üí WebSocket ‚Üí Main Process ‚Üí Hardware

### Real-time Considerations

- **Latency**: Typical 16ms (60fps) update rate
- **Throughput**: ~100KB/s for dual-knee data
- **Buffering**: 10-sample batches for efficiency
- **Reliability**: Auto-reconnection with exponential backoff

## üéØ Next Steps

### Immediate Setup
1. ‚úÖ Copy existing motion processing code
2. ‚úÖ Install dependencies and build
3. ‚úÖ Test basic device connection
4. ‚úÖ Verify WebSocket communication

### Enhancements
- [ ] Add session management UI
- [ ] Implement data export features  
- [ ] Add system health monitoring
- [ ] Create installation packages
- [ ] Setup automatic updates

### Production Deployment
- [ ] Code signing certificates
- [ ] Icon and branding assets
- [ ] User documentation
- [ ] Support & feedback channels

## üìû Support

If you encounter issues during migration:

1. **Check Console Logs**: Both main process and renderer logs
2. **WebSocket Status**: Verify connection in browser DevTools  
3. **Motion Processing**: Ensure coordinator initializes properly
4. **Device Permissions**: Check Bluetooth/USB access

The architecture is designed to be a drop-in replacement for your existing React app, with enhanced native device access and multi-client support.